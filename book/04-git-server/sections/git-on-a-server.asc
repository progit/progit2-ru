[[r_git_on_the_server]]
=== Установка Git на сервер

Рассмотрим теперь установку сервиса Git с поддержкой этих протоколов на сервер.

[NOTE]
====
Здесь мы приводим команды и шаги, необходимые для базовой, упрощённой установки на Linux-сервер, но эти сервисы можно запустить и на MacOS или Windows сервере.
На самом деле, установка боевого сервера в вашей инфраструктуре неминуемо будет иметь отличия в настройках безопасности или инструментах операционной системы, но мы надеемся дать вам общее понимание происходящего.
====

Для того чтобы приступить к установке любого сервера Git, вы должны экспортировать существующий репозиторий в новый голый репозиторий -- репозиторий без рабочего каталога.
Делается это просто.
Чтобы создать новый голый репозиторий -- во время клонирования используйте параметр `--bare`.(((команды git, clone, bare)))
По существующему соглашению, каталоги с голыми репозиториями заканчиваются на `.git`, например:

[source,console]
----
$ git clone --bare my_project my_project.git
Cloning into bare repository 'my_project.git'...
done.
----

Теперь у вас должна быть копия данных из каталога Git в каталоге `my_project.git`.

Грубо говоря, это эквивалентно команде:

[source,console]
----
$ cp -Rf my_project/.git my_project.git
----

Тут есть пара небольших различий в файле конфигурации, но в нашем случае эту разницу можно считать несущественной.
В этом случае берётся репозиторий Git без рабочего каталога и помещается в отдельный каталог.

[[r_bare_repo]]
==== Размещение голого репозитория на сервере

Теперь, когда у вас есть голая копия вашего репозитория, осталось поместить её на сервер и настроить протоколы.
Предположим, что вы уже настроили сервер `git.example.com`, имеете к нему доступ по SSH и хотите разместить все ваши репозитории Git в каталоге `/srv/git`.
Считая, что `/srv/git` уже есть на сервере, вы можете добавить ваш новый репозиторий копированием голого репозитория:

[source,console]
----
$ scp -r my_project.git user@git.example.com:/srv/git
----

Теперь другие пользователи, имеющие доступ к серверу по SSH и права на чтение каталога `/srv/git`, могут клонировать ваш репозиторий выполнив команду:

[source,console]
----
$ git clone user@git.example.com:/srv/git/my_project.git
----

Если у пользователя есть права записи в каталог `/srv/git/my_project.git`, он автоматически получает возможность отправки изменений в репозиторий.

Git автоматически добавит права на запись в репозиторий для группы при запуске команды `git init` с параметром `--shared`.
Следует отметить, что при запуске этой команды коммиты, ссылки и прочее удалены не будут.(((команды git, init, bare)))

[source,console]
----
$ ssh user@git.example.com
$ cd /srv/git/my_project.git
$ git init --bare --shared
----

Видите, как это просто, взять репозиторий Git, создать голую версию и поместить её на сервер, к которому вы и ваши коллеги имеете доступ по SSH.
Теперь вы готовы работать вместе над одним проектом.

Важно отметить, что это практически всё, что вам нужно сделать, чтобы получить рабочий Git-сервер, к которому имеют доступ несколько человек -- просто добавьте учетные записи с возможностью доступа по SSH на сервер и положите голый репозиторий в то место, к которому эти пользователи имеют доступ на чтение и запись.
И всё.

Из нескольких последующих разделов вы узнаете, как получить более сложные конфигурации.
В том числе как не создавать учётные записи для каждого пользователя, как сделать публичный доступ на чтение репозитория, как установить веб-интерфейс и др.
Однако, помните, что для совместной работы пары человек на закрытом проекте, всё что вам _нужно_ ― это SSH-сервер и голый репозиторий.

==== Малые установки

Если вы небольшая компания или вы только пробуете использовать Git в вашей организации и у вас небольшое число разработчиков, то всё достаточно просто.
Один из наиболее сложных аспектов настройки сервера Git -- это управление пользователями.
Если вы хотите, чтобы некоторые репозитории были доступны определённым пользователям только на чтение, а остальным на чтение и запись, то настроить доступ и привилегии будет несколько сложнее.

===== SSH доступ

(((Git-серверы, SSH)))
Если у вас уже есть сервер, к которому все ваши разработчики имеют доступ по SSH, проще всего разместить ваш первый репозиторий там, поскольку вам не нужно практически ничего делать (как мы уже обсудили в предыдущем разделе).
Если вы хотите более сложного управления правами доступа к вашим репозиториям, вы можете сделать это обычными правами файловой системы, предоставляемыми операционной системой вашего сервера.

Если вы хотите разместить ваши репозитории на сервере, где нет учётных записей для членов команды, которым требуются права на запись, то вы должны настроить доступ по SSH для них.
Будем считать, что если у вас для этого есть сервер, то SSH-сервер на нём уже установлен и через него вы получаете доступ.

Есть несколько способов предоставить доступ всем участникам вашей команды.
Первый -- создать учётные записи для каждого, это просто, но может быть весьма обременительно.
Вероятно, вы не захотите для каждого пользователя выполнять `adduser` (или `useradd`) и задавать временные пароли.

Второй способ -- это создать на сервере пользователя `git`, попросить всех участников, кому требуется доступ на запись, прислать вам открытый ключ SSH и добавить эти ключи в файл `~/.ssh/authorized_keys` в домашнем каталоге пользователя `git`.
Теперь все будут иметь доступ к этой машине используя пользователя `git`.
Это никак не повлияет на данные в коммите -- пользователь, под которым вы соединяетесь с сервером по SSH, не воздействует на созданные вами коммиты.

Другой способ сделать это -- настроить SSH сервер на использование аутентификации через LDAP-сервер или любой другой имеющийся у вас централизованный сервер аутентификации.
Вы можете использовать любой механизм аутентификации на сервере и считать что он будет работать для Git, если пользователь может получить доступ к консоли по SSH.
